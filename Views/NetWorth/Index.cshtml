@model NetWorthViewModel
@{
    ViewData["Title"] = "Net Worth";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0"><i class="bi bi-bank me-2"></i>Net Worth</h2>
</div>

<!-- Net Worth Summary -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card stat-card bg-success bg-opacity-10">
            <div class="card-body text-center">
                <div class="stat-label">Total Assets</div>
                <div class="stat-value text-success">@Model.TotalAssets.ToString("C")</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card bg-danger bg-opacity-10">
            <div class="card-body text-center">
                <div class="stat-label">Total Liabilities</div>
                <div class="stat-value text-danger">@Model.TotalLiabilities.ToString("C")</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card net-worth-card @(Model.NetWorth >= 0 ? "bg-primary" : "bg-warning") bg-opacity-10">
            <div class="card-body text-center">
                <div class="stat-label">Net Worth</div>
                <div class="stat-value @(Model.NetWorth >= 0 ? "net-worth-positive" : "net-worth-negative")">
                    @Model.NetWorth.ToString("C")
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Assets Section -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0 text-success"><i class="bi bi-arrow-up-circle me-2"></i>Assets</h5>
                <a asp-action="CreateAsset" class="btn btn-sm btn-success">
                    <i class="bi bi-plus-lg me-1"></i>Add Asset
                </a>
            </div>
            <div class="card-body">
                @if (Model.Assets.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th class="text-end">Value</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var asset in Model.Assets)
                                {
                                    <tr>
                                        <td>
                                            @asset.Name
                                            @if (!string.IsNullOrEmpty(asset.Notes))
                                            {
                                                <i class="bi bi-chat-dots text-muted ms-1" title="@asset.Notes"></i>
                                            }
                                        </td>
                                        <td><span class="badge bg-secondary">@asset.Type</span></td>
                                        <td class="text-end fw-bold text-success">@asset.Value.ToString("C")</td>
                                        <td class="text-center">
                                            <a asp-action="EditAsset" asp-route-id="@asset.Id" class="btn btn-sm btn-outline-secondary me-1">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <form asp-action="DeleteAsset" asp-route-id="@asset.Id" method="post" class="d-inline"
                                                  onsubmit="return confirmDelete('Are you sure you want to delete this asset?')">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr class="table-success">
                                    <td colspan="2"><strong>Total Assets</strong></td>
                                    <td class="text-end"><strong>@Model.TotalAssets.ToString("C")</strong></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                }
                else
                {
                    <div class="empty-state py-4">
                        <i class="bi bi-safe fs-1"></i>
                        <p class="mt-2">No assets added yet</p>
                        <a asp-action="CreateAsset" class="btn btn-success btn-sm">Add your first asset</a>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Liabilities Section -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0 text-danger"><i class="bi bi-arrow-down-circle me-2"></i>Liabilities</h5>
                <a asp-action="CreateLiability" class="btn btn-sm btn-danger">
                    <i class="bi bi-plus-lg me-1"></i>Add Liability
                </a>
            </div>
            <div class="card-body">
                @if (Model.Liabilities.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Interest</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var liability in Model.Liabilities)
                                {
                                    <tr>
                                        <td>
                                            @liability.Name
                                            @if (liability.DueDate.HasValue)
                                            {
                                                <div class="small text-muted">Due: @liability.DueDate.Value.ToString("MMM dd, yyyy")</div>
                                            }
                                        </td>
                                        <td>
                                            @if (liability.InterestRate.HasValue)
                                            {
                                                <span>@liability.InterestRate.Value.ToString("F2")%</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">-</span>
                                            }
                                        </td>
                                        <td class="text-end fw-bold text-danger">@liability.Amount.ToString("C")</td>
                                        <td class="text-center">
                                            <a asp-action="EditLiability" asp-route-id="@liability.Id" class="btn btn-sm btn-outline-secondary me-1">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <form asp-action="DeleteLiability" asp-route-id="@liability.Id" method="post" class="d-inline"
                                                  onsubmit="return confirmDelete('Are you sure you want to delete this liability?')">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr class="table-danger">
                                    <td colspan="2"><strong>Total Liabilities</strong></td>
                                    <td class="text-end"><strong>@Model.TotalLiabilities.ToString("C")</strong></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                }
                else
                {
                    <div class="empty-state py-4">
                        <i class="bi bi-credit-card fs-1"></i>
                        <p class="mt-2">No liabilities added</p>
                        <a asp-action="CreateLiability" class="btn btn-danger btn-sm">Add a liability</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Asset Breakdown Chart -->
@if (Model.Assets.Any())
{
    <div class="row mt-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0"><i class="bi bi-pie-chart me-2"></i>Asset Breakdown by Type</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="assetChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const assetData = @Html.Raw(Model.AssetBreakdownJson);
            if (assetData.labels && assetData.labels.length > 0) {
                createPieChart('assetChart', assetData);
            }
        });
    </script>
}
